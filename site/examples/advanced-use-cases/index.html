
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../basic-examples/">
      
      
        <link rel="next" href="../../licencing/educational-licence/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.40">
    
    
      
        <title>Zaawansowane przypadki użycia - </title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#zaawansowane-przypadki-uzycia" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="" class="md-header__button md-logo" aria-label="" data-md-component="logo">
      
  <img src="https://databackbone.tech/static/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Zaawansowane przypadki użycia
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="" class="md-nav__button md-logo" aria-label="" data-md-component="logo">
      
  <img src="https://databackbone.tech/static/images/logo.png" alt="logo">

    </a>
    
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Strona główna
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Pierwsze kroki
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Pierwsze kroki
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/env-description/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Opis środowiska
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/development-installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Instalacja środowiska developerskiego
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/production-installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Instalacja środowiska produkcyjnego
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/requirements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wymagane umiejętności
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Używane pojęcia
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Używane pojęcia
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zasoby
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/indicators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wskaźniki
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Schematy walidacji
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/webhooks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Webhooks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Przewodnik użytkownika
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Przewodnik użytkownika
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/data-fetching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pobieranie danych (zasobów)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/data-preprocessing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Przetwarzanie danych (wskaźników)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/data-sync/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Synchronizacja danych
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/api-usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Użycie DataBackbone API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Narzędzia wspierające
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Narzędzia wspierające
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/parallel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Działania równoległe
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/logging-debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logowanie i debugowanie
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Niektóre prompty, których używamy do pracy
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Niektóre prompty, których używamy do pracy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prompts/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prompts/workshops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Warsztaty z klientem
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prompts/code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generowanie kodu
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prompts/analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generowanie analiz biznesowych
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Przykłady
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Przykłady
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basic-examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Podstawowe przykłady
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Zaawansowane przypadki użycia
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Zaawansowane przypadki użycia
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#wprowadzenie" class="md-nav__link">
    <span class="md-ellipsis">
      Wprowadzenie
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#budowanie-zozonego-wskaznika" class="md-nav__link">
    <span class="md-ellipsis">
      Budowanie złożonego wskaźnika
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Budowanie złożonego wskaźnika">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wskaznik-worklogswithcyclenumbers" class="md-nav__link">
    <span class="md-ellipsis">
      Wskaźnik WorklogsWithCycleNumbers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#funkcja-budujaca-build_worklogs_with_cycle_number" class="md-nav__link">
    <span class="md-ellipsis">
      Funkcja budująca build_worklogs_with_cycle_number
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Funkcja budująca build_worklogs_with_cycle_number">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uzycie" class="md-nav__link">
    <span class="md-ellipsis">
      Użycie
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kluczowe-cechy" class="md-nav__link">
    <span class="md-ellipsis">
      Kluczowe cechy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementacja" class="md-nav__link">
    <span class="md-ellipsis">
      Implementacja
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kluczowe-komponenty" class="md-nav__link">
    <span class="md-ellipsis">
      Kluczowe komponenty
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kluczowe komponenty">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#klasa-indicator" class="md-nav__link">
    <span class="md-ellipsis">
      Klasa Indicator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#klasa-mongoclient" class="md-nav__link">
    <span class="md-ellipsis">
      Klasa MongoClient
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#funkcje-pomocnicze" class="md-nav__link">
    <span class="md-ellipsis">
      Funkcje pomocnicze
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schemat-wyjsciowy" class="md-nav__link">
    <span class="md-ellipsis">
      Schemat wyjściowy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pena-implementacja" class="md-nav__link">
    <span class="md-ellipsis">
      Pełna implementacja
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#podsumowanie" class="md-nav__link">
    <span class="md-ellipsis">
      Podsumowanie
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Licencjonowanie
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Licencjonowanie
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../licencing/educational-licence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Licencja edukacyjna
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../licencing/noncommercial-licence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Licencja dla Twojej firmy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../licencing/commercial-licence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Licencja komercyjna
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Współpraca
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Współpraca
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/how-to-contribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jak dołączyć do projektu?
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#wprowadzenie" class="md-nav__link">
    <span class="md-ellipsis">
      Wprowadzenie
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#budowanie-zozonego-wskaznika" class="md-nav__link">
    <span class="md-ellipsis">
      Budowanie złożonego wskaźnika
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Budowanie złożonego wskaźnika">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wskaznik-worklogswithcyclenumbers" class="md-nav__link">
    <span class="md-ellipsis">
      Wskaźnik WorklogsWithCycleNumbers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#funkcja-budujaca-build_worklogs_with_cycle_number" class="md-nav__link">
    <span class="md-ellipsis">
      Funkcja budująca build_worklogs_with_cycle_number
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Funkcja budująca build_worklogs_with_cycle_number">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uzycie" class="md-nav__link">
    <span class="md-ellipsis">
      Użycie
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kluczowe-cechy" class="md-nav__link">
    <span class="md-ellipsis">
      Kluczowe cechy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementacja" class="md-nav__link">
    <span class="md-ellipsis">
      Implementacja
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kluczowe-komponenty" class="md-nav__link">
    <span class="md-ellipsis">
      Kluczowe komponenty
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kluczowe komponenty">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#klasa-indicator" class="md-nav__link">
    <span class="md-ellipsis">
      Klasa Indicator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#klasa-mongoclient" class="md-nav__link">
    <span class="md-ellipsis">
      Klasa MongoClient
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#funkcje-pomocnicze" class="md-nav__link">
    <span class="md-ellipsis">
      Funkcje pomocnicze
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schemat-wyjsciowy" class="md-nav__link">
    <span class="md-ellipsis">
      Schemat wyjściowy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pena-implementacja" class="md-nav__link">
    <span class="md-ellipsis">
      Pełna implementacja
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#podsumowanie" class="md-nav__link">
    <span class="md-ellipsis">
      Podsumowanie
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="zaawansowane-przypadki-uzycia">Zaawansowane przypadki użycia</h1>
<h2 id="wprowadzenie">Wprowadzenie</h2>
<p>W tym rozdziale przedstawimy zaawansowany przypadek użycia DataBackbone, koncentrując się na procesie budowania złożonego wskaźnika. Jako przykład wykorzystamy funkcję <code>build_worklogs_with_cycle_number</code>, która tworzy wskaźnik <code>WorklogsWithCycleNumbers</code>. Ten wskaźnik łączy dane z różnych źródeł i przetwarza je w celu uzyskania cennych informacji biznesowych o dziennikach pracy powiązanych z cyklami rozliczeniowymi.</p>
<h2 id="budowanie-zozonego-wskaznika">Budowanie złożonego wskaźnika</h2>
<h3 id="wskaznik-worklogswithcyclenumbers">Wskaźnik <code>WorklogsWithCycleNumbers</code></h3>
<p>Wskaźnik <code>WorklogsWithCycleNumbers</code> dostarcza informacji o dziennikach pracy (worklogs) powiązanych z cyklami rozliczeniowymi. Łączy on dane z różnych źródeł, takich jak faktury, wpisy czasowe i zadania, aby stworzyć kompleksowy obraz pracy wykonanej w ramach poszczególnych cykli rozliczeniowych.</p>
<h3 id="funkcja-budujaca-build_worklogs_with_cycle_number">Funkcja budująca <code>build_worklogs_with_cycle_number</code></h3>
<p>Funkcja <code>build_worklogs_with_cycle_number</code> jest odpowiedzialna za tworzenie wskaźnika <code>WorklogsWithCycleNumbers</code>.</p>
<h4 id="uzycie">Użycie</h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span> <span class="nf">build_worklogs_with_cycle_number</span><span class="p">(</span><span class="n">indicator_setting</span><span class="p">:</span> <span class="n">Indicator</span><span class="p">,</span> <span class="n">db_client</span><span class="p">:</span> <span class="n">MongoClient</span><span class="p">):</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="c1"># Implementacja funkcji</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="c1"># ...</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="k">return</span> <span class="n">Validator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">final_results</span><span class="p">,</span> <span class="n">schema_out</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;records&#39;</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="kluczowe-cechy">Kluczowe cechy</h4>
<ul>
<li>Pobieranie danych z wielu źródeł (faktury, wpisy czasowe, zadania)</li>
<li>Przetwarzanie i łączenie danych z wykorzystaniem pandas</li>
<li>Mapowanie płatności do dzienników pracy</li>
<li>Aktualizacja arkuszy Google dla wybranych klientów</li>
<li>Walidacja wynikowych danych</li>
</ul>
<h3 id="implementacja">Implementacja</h3>
<p>Poniżej przedstawiamy kluczowe elementy implementacji:</p>
<ol>
<li>Pobieranie danych z bazy MongoDB:</li>
</ol>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">stripe_invoices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db_client</span><span class="p">[</span><span class="s1">&#39;RESOURCES&#39;</span><span class="p">][</span><span class="s1">&#39;StripeInvoices&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">())</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">clickup_time_entries</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db_client</span><span class="p">[</span><span class="s1">&#39;RESOURCES&#39;</span><span class="p">][</span><span class="s1">&#39;ClickupTimeEntries&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">())</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">clickup_tasks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db_client</span><span class="p">[</span><span class="s1">&#39;RESOURCES&#39;</span><span class="p">][</span><span class="s1">&#39;ClickupTasks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">())</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">clients</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db_client</span><span class="p">[</span><span class="s1">&#39;RESOURCES&#39;</span><span class="p">][</span><span class="s1">&#39;ClientMapping&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">())</span>
</span></code></pre></div>
<ol>
<li>Przetwarzanie danych dla każdego klienta:</li>
</ol>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="n">clients</span><span class="p">:</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="n">filtered_invoices</span> <span class="o">=</span> <span class="n">filter_stripe_invoices</span><span class="p">(</span><span class="n">stripe_invoices</span><span class="p">,</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;stripe_customer_id&#39;</span><span class="p">])</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">filtered_time_entries</span> <span class="o">=</span> <span class="n">filter_clickup_entries</span><span class="p">(</span><span class="n">clickup_time_entries</span><span class="p">,</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;clickup_folder_id&#39;</span><span class="p">])</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="n">filtered_tasks</span> <span class="o">=</span> <span class="n">filter_clickup_tasks</span><span class="p">(</span><span class="n">clickup_tasks</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">client</span><span class="p">[</span><span class="s1">&#39;clickup_folder_id&#39;</span><span class="p">]))</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="n">mapped_payments_to_worklogs</span> <span class="o">=</span> <span class="n">map_payments_to_all_worklogs</span><span class="p">(</span><span class="n">filtered_time_entries</span><span class="p">,</span> <span class="n">filtered_invoices</span><span class="p">,</span> <span class="n">filtered_tasks</span><span class="p">)</span>
</span></code></pre></div>
<ol>
<li>Aktualizacja arkuszy Google dla wybranych klientów:</li>
</ol>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">if</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;company_name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">project_spreadsheets</span><span class="p">:</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span class="n">logs_with_cycle_number</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>        <span class="p">{</span><span class="o">**</span><span class="n">log</span><span class="p">,</span> <span class="s1">&#39;cycle_number&#39;</span><span class="p">:</span> <span class="n">cycle</span><span class="p">[</span><span class="s1">&#39;cycle_number&#39;</span><span class="p">]}</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>        <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="n">mapped_payments_to_worklogs</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>        <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">[</span><span class="s1">&#39;log_info&#39;</span><span class="p">]</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    <span class="p">]</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    <span class="n">structure_for_google_sheet</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>        <span class="s2">&quot;logs_with_cycle_number&quot;</span><span class="p">:</span> <span class="n">logs_with_cycle_number</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>    <span class="p">}</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    <span class="n">update_client_google_sheet</span><span class="p">(</span><span class="n">client</span><span class="p">[</span><span class="s1">&#39;company_name&#39;</span><span class="p">],</span> <span class="n">structure_for_google_sheet</span><span class="p">[</span><span class="s1">&#39;logs_with_cycle_number&#39;</span><span class="p">],</span> <span class="n">worksheet_names</span><span class="p">[</span><span class="s1">&#39;WorklogsWithCycleNumber&#39;</span><span class="p">])</span>
</span></code></pre></div>
<ol>
<li>Tworzenie końcowego wyniku:</li>
</ol>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">new_row</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span class="s1">&#39;client&#39;</span><span class="p">:</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;company_name&#39;</span><span class="p">],</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;company_name&#39;</span><span class="p">],</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="s1">&#39;mapped_payments_to_worklogs&#39;</span><span class="p">:</span> <span class="n">mapped_payments_to_worklogs</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="p">}</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="n">final_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">final_results</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">new_row</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div>
<h2 id="kluczowe-komponenty">Kluczowe komponenty</h2>
<h3 id="klasa-indicator">Klasa <code>Indicator</code></h3>
<p>Klasa <code>Indicator</code> reprezentuje strukturę wskaźnika w DataBackbone. Zawiera informacje takie jak nazwa wskaźnika, opis i wymagane pola.</p>
<h3 id="klasa-mongoclient">Klasa <code>MongoClient</code></h3>
<p><code>MongoClient</code> to klasa z biblioteki PyMongo, używana do interakcji z bazą danych MongoDB.</p>
<h3 id="funkcje-pomocnicze">Funkcje pomocnicze</h3>
<ul>
<li><code>filter_stripe_invoices()</code>: Filtruje faktury Stripe dla danego klienta.</li>
<li><code>filter_clickup_entries()</code>: Filtruje wpisy czasowe ClickUp dla danego folderu.</li>
<li><code>filter_clickup_tasks()</code>: Filtruje zadania ClickUp dla danego folderu.</li>
<li><code>map_payments_to_all_worklogs()</code>: Mapuje płatności do wszystkich dzienników pracy.</li>
<li><code>update_client_google_sheet()</code>: Aktualizuje arkusz Google dla klienta.</li>
</ul>
<h2 id="schemat-wyjsciowy">Schemat wyjściowy</h2>
<p>Schemat wyjściowy (<code>schema_out</code>) definiuje strukturę danych wynikowych wskaźnika <code>WorklogsWithCycleNumbers</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">schema_out</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="s2">&quot;client&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    <span class="s2">&quot;mapped_payments_to_worklogs&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>        <span class="p">{</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>            <span class="s2">&quot;cycle_number&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>            <span class="s2">&quot;log_info&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>                <span class="p">{</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>                    <span class="s2">&quot;date_of_log&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>                    <span class="s2">&quot;worked_time&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>                    <span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>                    <span class="s2">&quot;task_name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>                    <span class="s2">&quot;task_id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>                    <span class="s2">&quot;task_tag_name&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)),</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>                <span class="p">}</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>            <span class="p">]</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>        <span class="p">}</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>    <span class="p">]</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="pena-implementacja">Pełna implementacja</h2>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="kn">from</span> <span class="nn">__indicators__.types</span> <span class="kn">import</span> <span class="n">Indicator</span><span class="p">,</span> <span class="n">MongoClient</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="kn">from</span> <span class="nn">external_services.google.gsheet_utils</span> <span class="kn">import</span> <span class="n">update_client_google_sheet</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="kn">from</span> <span class="nn">utils.validator</span> <span class="kn">import</span> <span class="n">Validator</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="kn">from</span> <span class="nn">__indicators__.utils.build_worklogs_with_cycle_number</span> <span class="kn">import</span> <span class="n">filter_clickup_entries</span><span class="p">,</span> <span class="n">filter_clickup_tasks</span><span class="p">,</span> <span class="n">filter_stripe_invoices</span><span class="p">,</span> <span class="n">find_all_logs_for_cycles</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="kn">from</span> <span class="nn">external_services.client_mappings_details.gsheet_mappings</span> <span class="kn">import</span> <span class="n">project_spreadsheets</span><span class="p">,</span> <span class="n">worksheet_names</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="k">def</span> <span class="nf">map_payments_to_all_worklogs</span><span class="p">(</span><span class="n">worklogs</span><span class="p">,</span> <span class="n">invoices</span><span class="p">,</span> <span class="n">tasks</span><span class="p">):</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    <span class="c1"># Konwertuj listy na DataFrame</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>    <span class="n">worklogs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">worklogs</span><span class="p">)</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>    <span class="n">invoices_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">invoices</span><span class="p">)</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>    <span class="n">tasks_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>    <span class="c1"># Sortowanie faktur według daty stworzenia (od najstarszej do najnowszej) i resetowanie indeksu</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>    <span class="n">sorted_invoices</span> <span class="o">=</span> <span class="n">invoices_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;created&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>    <span class="c1"># Konwersja kolumny &#39;created&#39; na datetime</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>    <span class="n">sorted_invoices</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">sorted_invoices</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>    <span class="c1"># Tworzenie kolumny &#39;end_of_cycle&#39;</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>    <span class="n">sorted_invoices</span><span class="p">[</span><span class="s1">&#39;end_of_cycle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorted_invoices</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>    <span class="n">sorted_invoices</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sorted_invoices</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;end_of_cycle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorted_invoices</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>    <span class="c1"># Dodanie kolumny &#39;cycle_number&#39;</span>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>    <span class="n">sorted_invoices</span><span class="p">[</span><span class="s1">&#39;cycle_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_invoices</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>    <span class="c1"># Tworzenie DataFrame mapped_invoices_to_cycles</span>
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>    <span class="n">mapped_invoices_to_cycles_df</span> <span class="o">=</span> <span class="n">sorted_invoices</span><span class="p">[[</span><span class="s1">&#39;cycle_number&#39;</span><span class="p">,</span> <span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="s1">&#39;end_of_cycle&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;created&#39;</span><span class="p">:</span> <span class="s1">&#39;invoice_creation_date_object&#39;</span><span class="p">})</span>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>    <span class="c1"># Znalezienie wszystkich dzienników pracy dla cykli</span>
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>    <span class="n">mapped_worklogs_to_invoices</span> <span class="o">=</span> <span class="n">find_all_logs_for_cycles</span><span class="p">(</span><span class="n">mapped_invoices_to_cycles_df</span><span class="p">,</span> <span class="n">worklogs_df</span><span class="p">,</span> <span class="n">tasks_df</span><span class="p">)</span>
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>    <span class="c1"># Zwróć zmapowane dzienniki pracy do faktur</span>
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>    <span class="k">return</span> <span class="n">mapped_worklogs_to_invoices</span>
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="n">schema_out</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>    <span class="s2">&quot;client&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-6-40"><a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a>    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-6-41"><a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a>    <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-6-42"><a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a>    <span class="s2">&quot;mapped_payments_to_worklogs&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-6-43"><a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a>        <span class="p">{</span>
</span><span id="__span-6-44"><a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a>            <span class="s2">&quot;cycle_number&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-6-45"><a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a>            <span class="s2">&quot;log_info&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-6-46"><a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a>                <span class="p">{</span>
</span><span id="__span-6-47"><a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a>                    <span class="s2">&quot;date_of_log&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-6-48"><a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a>                    <span class="s2">&quot;worked_time&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="__span-6-49"><a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a>                    <span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-6-50"><a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a>                    <span class="s2">&quot;task_name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-6-51"><a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a>                    <span class="s2">&quot;task_id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-6-52"><a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a>                    <span class="s2">&quot;task_tag_name&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)),</span>
</span><span id="__span-6-53"><a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a>                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-6-54"><a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a>                <span class="p">}</span>
</span><span id="__span-6-55"><a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a>            <span class="p">]</span>
</span><span id="__span-6-56"><a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a>        <span class="p">}</span>
</span><span id="__span-6-57"><a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a>    <span class="p">]</span>
</span><span id="__span-6-58"><a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a><span class="p">}</span>
</span><span id="__span-6-59"><a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a>
</span><span id="__span-6-60"><a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a><span class="c1"># Główna funkcja przetwarzająca</span>
</span><span id="__span-6-61"><a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a>
</span><span id="__span-6-62"><a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a><span class="k">def</span> <span class="nf">build_worklogs_with_cycle_number</span><span class="p">(</span><span class="n">indicator_setting</span><span class="p">:</span> <span class="n">Indicator</span><span class="p">,</span> <span class="n">db_client</span><span class="p">:</span> <span class="n">MongoClient</span><span class="p">):</span>
</span><span id="__span-6-63"><a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a>    <span class="c1"># Pobierz dane StripeInvoices i ClickupTimeEntries</span>
</span><span id="__span-6-64"><a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a>    <span class="n">stripe_invoices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db_client</span><span class="p">[</span><span class="s1">&#39;RESOURCES&#39;</span><span class="p">][</span><span class="s1">&#39;StripeInvoices&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">())</span>
</span><span id="__span-6-65"><a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a>    <span class="n">clickup_time_entries</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db_client</span><span class="p">[</span><span class="s1">&#39;RESOURCES&#39;</span><span class="p">][</span><span class="s1">&#39;ClickupTimeEntries&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">())</span>
</span><span id="__span-6-66"><a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a>    <span class="n">clickup_tasks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db_client</span><span class="p">[</span><span class="s1">&#39;RESOURCES&#39;</span><span class="p">][</span><span class="s1">&#39;ClickupTasks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">())</span>
</span><span id="__span-6-67"><a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a>    <span class="n">clients</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db_client</span><span class="p">[</span><span class="s1">&#39;RESOURCES&#39;</span><span class="p">][</span><span class="s1">&#39;ClientMapping&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">())</span>
</span><span id="__span-6-68"><a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a>
</span><span id="__span-6-69"><a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a>    <span class="n">final_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;client&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;mapped_payments_to_worklogs&#39;</span><span class="p">])</span>
</span><span id="__span-6-70"><a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a>
</span><span id="__span-6-71"><a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a>    <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="n">clients</span><span class="p">:</span>
</span><span id="__span-6-72"><a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a>
</span><span id="__span-6-73"><a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a>        <span class="n">filtered_invoices</span> <span class="o">=</span> <span class="n">filter_stripe_invoices</span><span class="p">(</span><span class="n">stripe_invoices</span><span class="p">,</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;stripe_customer_id&#39;</span><span class="p">])</span>
</span><span id="__span-6-74"><a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a>        <span class="n">filtered_time_entries</span> <span class="o">=</span> <span class="n">filter_clickup_entries</span><span class="p">(</span><span class="n">clickup_time_entries</span><span class="p">,</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;clickup_folder_id&#39;</span><span class="p">])</span>
</span><span id="__span-6-75"><a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a>        <span class="n">filtered_tasks</span> <span class="o">=</span> <span class="n">filter_clickup_tasks</span><span class="p">(</span><span class="n">clickup_tasks</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">client</span><span class="p">[</span><span class="s1">&#39;clickup_folder_id&#39;</span><span class="p">]))</span>
</span><span id="__span-6-76"><a id="__codelineno-6-76" name="__codelineno-6-76" href="#__codelineno-6-76"></a>
</span><span id="__span-6-77"><a id="__codelineno-6-77" name="__codelineno-6-77" href="#__codelineno-6-77"></a>        <span class="n">mapped_payments_to_worklogs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-6-78"><a id="__codelineno-6-78" name="__codelineno-6-78" href="#__codelineno-6-78"></a>
</span><span id="__span-6-79"><a id="__codelineno-6-79" name="__codelineno-6-79" href="#__codelineno-6-79"></a>        <span class="n">mapped_payments_to_worklogs</span> <span class="o">=</span> <span class="n">map_payments_to_all_worklogs</span><span class="p">(</span><span class="n">filtered_time_entries</span><span class="p">,</span> <span class="n">filtered_invoices</span><span class="p">,</span> <span class="n">filtered_tasks</span><span class="p">)</span>
</span><span id="__span-6-80"><a id="__codelineno-6-80" name="__codelineno-6-80" href="#__codelineno-6-80"></a>
</span><span id="__span-6-81"><a id="__codelineno-6-81" name="__codelineno-6-81" href="#__codelineno-6-81"></a>        <span class="k">if</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;company_name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">project_spreadsheets</span><span class="p">:</span>
</span><span id="__span-6-82"><a id="__codelineno-6-82" name="__codelineno-6-82" href="#__codelineno-6-82"></a>            <span class="c1"># Tworzymy listę słowników bezpośrednio z mapped_payments_to_worklogs</span>
</span><span id="__span-6-83"><a id="__codelineno-6-83" name="__codelineno-6-83" href="#__codelineno-6-83"></a>            <span class="n">logs_with_cycle_number</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-6-84"><a id="__codelineno-6-84" name="__codelineno-6-84" href="#__codelineno-6-84"></a>                <span class="p">{</span><span class="o">**</span><span class="n">log</span><span class="p">,</span> <span class="s1">&#39;cycle_number&#39;</span><span class="p">:</span> <span class="n">cycle</span><span class="p">[</span><span class="s1">&#39;cycle_number&#39;</span><span class="p">]}</span>
</span><span id="__span-6-85"><a id="__codelineno-6-85" name="__codelineno-6-85" href="#__codelineno-6-85"></a>                <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="n">mapped_payments_to_worklogs</span>
</span><span id="__span-6-86"><a id="__codelineno-6-86" name="__codelineno-6-86" href="#__codelineno-6-86"></a>                <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">[</span><span class="s1">&#39;log_info&#39;</span><span class="p">]</span>
</span><span id="__span-6-87"><a id="__codelineno-6-87" name="__codelineno-6-87" href="#__codelineno-6-87"></a>            <span class="p">]</span>
</span><span id="__span-6-88"><a id="__codelineno-6-88" name="__codelineno-6-88" href="#__codelineno-6-88"></a>
</span><span id="__span-6-89"><a id="__codelineno-6-89" name="__codelineno-6-89" href="#__codelineno-6-89"></a>            <span class="c1"># Tworzymy nowy słownik z przekształconymi danymi</span>
</span><span id="__span-6-90"><a id="__codelineno-6-90" name="__codelineno-6-90" href="#__codelineno-6-90"></a>            <span class="n">structure_for_google_sheet</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-6-91"><a id="__codelineno-6-91" name="__codelineno-6-91" href="#__codelineno-6-91"></a>                <span class="s2">&quot;logs_with_cycle_number&quot;</span><span class="p">:</span> <span class="n">logs_with_cycle_number</span>
</span><span id="__span-6-92"><a id="__codelineno-6-92" name="__codelineno-6-92" href="#__codelineno-6-92"></a>            <span class="p">}</span>
</span><span id="__span-6-93"><a id="__codelineno-6-93" name="__codelineno-6-93" href="#__codelineno-6-93"></a>
</span><span id="__span-6-94"><a id="__codelineno-6-94" name="__codelineno-6-94" href="#__codelineno-6-94"></a>            <span class="n">update_client_google_sheet</span><span class="p">(</span><span class="n">client</span><span class="p">[</span><span class="s1">&#39;company_name&#39;</span><span class="p">],</span><span class="n">structure_for_google_sheet</span><span class="p">[</span><span class="s1">&#39;logs_with_cycle_number&#39;</span><span class="p">],</span> <span class="n">worksheet_names</span><span class="p">[</span><span class="s1">&#39;WorklogsWithCycleNumber&#39;</span><span class="p">])</span>
</span><span id="__span-6-95"><a id="__codelineno-6-95" name="__codelineno-6-95" href="#__codelineno-6-95"></a>        <span class="n">new_row</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-6-96"><a id="__codelineno-6-96" name="__codelineno-6-96" href="#__codelineno-6-96"></a>            <span class="s1">&#39;client&#39;</span><span class="p">:</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;company_name&#39;</span><span class="p">],</span>
</span><span id="__span-6-97"><a id="__codelineno-6-97" name="__codelineno-6-97" href="#__codelineno-6-97"></a>            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;company_name&#39;</span><span class="p">],</span>
</span><span id="__span-6-98"><a id="__codelineno-6-98" name="__codelineno-6-98" href="#__codelineno-6-98"></a>            <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span>
</span><span id="__span-6-99"><a id="__codelineno-6-99" name="__codelineno-6-99" href="#__codelineno-6-99"></a>            <span class="s1">&#39;mapped_payments_to_worklogs&#39;</span><span class="p">:</span> <span class="n">mapped_payments_to_worklogs</span>
</span><span id="__span-6-100"><a id="__codelineno-6-100" name="__codelineno-6-100" href="#__codelineno-6-100"></a>        <span class="p">}</span>
</span><span id="__span-6-101"><a id="__codelineno-6-101" name="__codelineno-6-101" href="#__codelineno-6-101"></a>        <span class="n">final_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">final_results</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">new_row</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-6-102"><a id="__codelineno-6-102" name="__codelineno-6-102" href="#__codelineno-6-102"></a>
</span><span id="__span-6-103"><a id="__codelineno-6-103" name="__codelineno-6-103" href="#__codelineno-6-103"></a>    <span class="k">return</span> <span class="n">Validator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">final_results</span><span class="p">,</span><span class="n">schema_out</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;records&#39;</span><span class="p">)</span>
</span></code></pre></div>
<h2 id="podsumowanie">Podsumowanie</h2>
<p>Funkcja <code>build_worklogs_with_cycle_number</code> demonstruje zaawansowane możliwości DataBackbone w zakresie budowania złożonych wskaźników. Proces tworzenia wskaźnika <code>WorklogsWithCycleNumbers</code> obejmuje pobieranie danych z bazy MongoDB, filtrowanie i przetwarzanie danych dla każdego klienta, mapowanie płatności do dzienników pracy, aktualizację zewnętrznych arkuszy Google oraz tworzenie końcowego raportu. Takie podejście pozwala na tworzenie kompleksowych wskaźników biznesowych, które mogą być wykorzystywane do analizy i optymalizacji procesów w firmie.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2016 - 2020 Martin Donath
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.525ec568.min.js"></script>
      
        <script src="../../javascripts/highlight.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>